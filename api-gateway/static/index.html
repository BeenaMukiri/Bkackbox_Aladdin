<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Login - Minimal Starter</title>
  <style>
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Helvetica,Arial}
    .page{min-height:100vh;display:flex;align-items:center;justify-content:center;background:#f6f7f9}
    .card{width:100%;max-width:380px;background:#fff;border-radius:16px;box-shadow:0 10px 30px rgba(0,0,0,.06);padding:24px}
    h1{margin:0 0 4px;font-size:22px}
    p{margin:0 0 16px;color:#6b7280}
    label{display:block;font-size:13px;color:#111827;margin:10px 0 6px}
    input{width:100%;padding:10px 12px;border:1px solid #e5e7eb;border-radius:10px;outline:none}
    button{width:100%;padding:10px;border:0;border-radius:10px;background:#111;color:#fff;margin-top:14px;cursor:pointer}
    .row{display:flex;justify-content:space-between;align-items:center;margin-top:10px}
    a{font-size:13px;color:#2563eb;text-decoration:none}
    .muted{color:#6b7280}
    .status{margin-top:12px;font-size:13px}
    .ok{color:#065f46}
    .err{color:#991b1b}
    .outline{background:#fff;color:#111;border:1px solid #e5e7eb}
  </style>
</head>
<body>
  <div class="page">
    <div class="card">
      <h1>Welcome back</h1>
      <p class="muted">Sign in to continue</p>
      <form id="loginForm">
        <label>Username</label>
        <input id="username" placeholder="e.g. demo" required>
        <label>Password</label>
        <input id="password" type="password" placeholder="********" required>
        <button>Sign In</button>
      </form>
      <div class="row">
        <a href="#" id="registerLink">Quick register demo user</a>
        <a href="#" id="logoutLink" class="muted">Logout</a>
      </div>
      <div id="status" class="status"></div>
      <hr style="margin:16px 0;border:0;border-top:1px solid #eee">
      <button id="chargeBtn" class="outline">Test payment call (open)</button>
    </div>
  </div>
<script>
const statusEl = document.getElementById('status');
function setStatus(msg, ok=true){statusEl.textContent=msg;statusEl.className='status ' + (ok?'ok':'err');}

document.getElementById('loginForm').addEventListener('submit', async (e)=>{
  e.preventDefault();
  try{
    const res = await fetch('/auth/login', {
      method:'POST', headers:{'Content-Type':'application/json'},
      body: JSON.stringify({ username: username.value.trim(), password: password.value })
    });
    const data = await res.json();
    if(!res.ok) throw new Error(data.error||'Login failed');
    setStatus('Logged in as '+data.user.username);
  }catch(err){ setStatus(err.message,false); }
});

document.getElementById('registerLink').addEventListener('click', async (e)=>{
  e.preventDefault();
  try{
    const res = await fetch('/auth/register', {
      method:'POST', headers:{'Content-Type':'application/json'},
      body: JSON.stringify({ username:'demo', email:'demo@example.com', password:'Passw0rd!' })
    });
    const data = await res.json();
    if(!res.ok) throw new Error(data.error||'Register failed');
    setStatus('Registered '+data.user.username);
  }catch(err){ setStatus(err.message,false); }
});

document.getElementById('logoutLink').addEventListener('click', async (e)=>{
  e.preventDefault();
  try{
    await fetch('/auth/logout', { method:'POST' });
    setStatus('Logged out.');
  }catch(err){ setStatus(err.message,false); }
});

document.getElementById('chargeBtn').addEventListener('click', async ()=>{
  try{
    const res = await fetch('/payments/charge', {
      method:'POST', headers:{'Content-Type':'application/json'},
      body: JSON.stringify({ amount:199, currency:'INR' })
    });
    const data = await res.json();
    if(!res.ok) throw new Error(data.error||'Charge failed');
    setStatus('Payment stub ok: '+JSON.stringify(data));
  }catch(err){ setStatus(err.message,false); }
});
</script>
</body>
</html>
